<div class="container-fluid">

  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <ul class="nav navbar-nav">
        <li routerLinkActive="active"><a routerLink="/">Home</a></li>
        <li><a routerLink="/login" (click)="logout()">Logout</a></li>      
      </ul>
    </div>
  </nav>

  <div class="text-center" style="color: red;">
    <h1>
      <b>Assigned Operational Performance Indicators</b>
    </h1>
  </div>
  <!--edit section-->
  <div class="panel" *ngIf="selectedOpi">
    <div class="panel-heading background-4">
      <h4 class="panel-title ">
        <a data-toggle="collapse" href="#edit-section">Edit Section</a>
      </h4>
    </div>
    <div id="edit-section" class="panel-collapse collapse in">
      <div class="panel-body">
        <div class="row">
          <div class="col-lg-6">
            <label>Strategic Goal :</label>
            {{selectedOpi.goal}}
          </div>
          <div class="col-lg-6">
            <label>Initiative :</label>
            {{selectedInitiative.initiative}}
          </div>
          <div class="col-lg-6">
            <label>Activity :</label>
            {{selectedActivity.activity}}
          </div>
          <div class="col-lg-6">
            <label>OPI :</label>
            {{selectedMeasure.opi}}
          </div>
          <div class="col-lg-6">
            <label>Frequency :</label>
            {{selectedMeasure.frequency}}
          </div>
          <div class="col-lg-6">
            <label>Measure Unit :</label>
            {{selectedMeasure.measureUnit}}
          </div>
          <div class="col-lg-6">
            <label>Base Line :</label>
            {{selectedMeasure.departmentInfo[0].baseline}}
          </div>
          <div class="col-lg-6">
            <label>Evidence Form Type :</label>
            {{selectedMeasure.evidanceForm}}
            <p *ngIf="!selectedMeasure.evidanceForm">None</p>
          </div>
        </div>

        <table id="accordion" class="table table-bordered">
            <thead>
              <tr>
                <th>Year</th>
                <th>Estimated Cost</th>
                <th>Quarter</th>
                <th>Estimated Target Level</th>
                <th>Current Cost</th>
                <th>Current Target Level</th>
                <th>End Date</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody *ngFor="let tdl of selectedMeasure.departmentInfo[0].opiAnnualTargets;let at=index;">
              <tr>
                <td [attr.rowspan]="tdl.levels.length + 3" style="vertical-align: middle;">{{tdl.year}}</td>
                <td [attr.rowspan]="tdl.levels.length + 3" style="vertical-align: middle;">{{tdl.estimatedCost}}</td>
              </tr>
              <ng-template let-lev ngFor [ngForOf]="tdl.levels" let-in="index">
                <tr>
                  <td>{{lev.quarter}}</td>
                  <td>{{lev.estimatedTargetLevel}}</td>
                  <td>{{lev.currentCost}}</td>
                  <td>{{lev.currentTargetLevel}}</td>
                  <td>{{lev.endDate + tdl.year}}</td>
                  <td style="text-transform: capitalize;">{{lev.status}}</td>
                  <td>
                    <button class="btn-link" data-toggle="modal" data-target="#feedbackModal" (click)="selectedLevel = lev;"> Approve/Reject</button>
                  </td>
                </tr>
                <tr *ngIf="lev.evidance&&lev.evidance.length">
                  <td colspan="6">
                    <b>Evidences</b>
                    <br>
                    <div class="row" *ngFor="let ev of lev.evidance;let e = index;">
                      <div class="col-lg-6">
                        <a [attr.href]="ev.url">{{e+1}}) evidance {{e+1}}</a>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="lev.internshipGraph&&lev.internshipGraph.length" >
                  <td></td>
                  <td colspan="5">
                    <table class="table table-bordered">
                      <caption>
                        <b>Internship Details</b>
                      </caption>
                      <thead>
                        <tr>
                          <th>Organization</th>
                          <th>Supervisor</th>
                          <th>Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let data of lev.internshipGraph;let z = index;">
                          <td>{{data.organization}}</td>
                          <td>{{data.internalSupervisior}}</td>
                          <td>{{data.count}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>
                <tr *ngIf="lev.mouDetails&&lev.mouDetails.length">
                  <td></td>
                  <td colspan="5">
                    <table class="table table-bordered">
                      <caption><b>Mous Detail</b></caption>
                      <thead>
                        <tr>
                          <th>Mou Type</th>
                          <th>Organisation</th>
                        </tr>
                      </thead>
                      <tbody *ngFor="let detail of lev.mouDetails;let d = index;">
                        <tr>
                          <td>{{detail.mouType}}</td>
                          <td>{{detail.organization}}</td>
                        </tr>
                        <tr *ngIf="detail.evidance.length">
                          <td colspan="2">
                            <b>Evidences</b>
                            <br>
                            <div class="row" *ngFor="let ev of detail.evidance;let e = index;">
                              <div class="col-lg-6">
                                <a [attr.href]="ev.url">{{e+1}}) evidance {{e+1}}</a>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>
              </ng-template>
            </tbody>
          </table>
      </div>
    </div>
  </div>
  <div class="panel">
    <div class="panel-heading  background-4">
      <h4 class="panel-title">
        <a>Assigned Operational Indicator</a>
      </h4>
    </div>
    <div class="panel-body">
      <table class="table table-bordered">
        <colgroup>
          <col style="width:20%">
          <col style="width:20%">
          <col style="width:20%">
          <col style="width:20%">
          <col style="width:10%">
          <col style="width:6.5%">
          <col style="width:3.5%">
        </colgroup>
        <thead class="header-background" *ngIf="goals.length">
          <tr>
            <th>Goal
              <span class="search">
                <input type="text" name="search" (keyup)="searchGoal($event)" placeholder="Search..">
              </span>
            </th>
            <th>Initiative
              <span class="search">
                <input type="text" name="search" (keyup)="searchInitiative($event)" placeholder="Search..">
              </span>
            </th>
            <th>Activity
              <span class="search">
                <input type="text" name="search" (keyup)="searchActivity($event)" placeholder="Search..">
              </span>
            </th>
            <th>KPI
              <span class="search">
                <input type="text" name="search" (keyup)="searchOpi($event)" placeholder="Search..">
              </span>
            </th>
            <th>Frequency</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let goal of goals;let i = index;">
            <td>{{goal.goal}}</td>
            <td colspan="6" style="padding:0px;border:none;" #element [style.height]="get(element)">
              <table class="table table-bordered" style="height: inherit;">
                <colgroup>
                  <col style="width:25%">
                  <col style="width:75%">
                </colgroup>
                <tr *ngFor="let initiate of goal.initiatives;let j=index;">
                  <td>{{initiate.initiative}}</td>
                  <td colspan="4" style="padding:0px;" #element1 [style.height]="get(element1)">
                    <table class="table table-bordered" style="height: inherit;">
                      <colgroup>
                        <col style="width:33.33%">
                        <col style="width:66.67">
                      </colgroup>
                      <tr *ngFor="let activit of initiate.activities;let k=index;">
                        <td [style.border-top]="k?'1px solid #ddd':'none'">{{activit.activity}}</td>
                        <td colspan="4" style="padding:0px;" #element2 [style.height]="get(element2) + ' !important'">
                          <table class="table table-bordered" style="height: inherit;">
                            <colgroup>
                              <col style="width:50.5%">
                              <col style="width:25%">
                              <col >
                              <col >
                            </colgroup>
                            <tr *ngFor="let msr of activit.opis;let l=index">
                              <td [style.border-top]="l?'1px solid #ddd':'none'">{{msr.opi}}</td>
                              <td [style.border-top]="l?'1px solid #ddd':'none'">{{msr.frequency}}</td>
                              <td style="text-transform: capitalize;">{{msr.departmentInfo["0"].opiAnnualTargets["0"].levels["0"].status}}</td>
                              <td [style.border-top]="l?'1px solid #ddd':'none'">
                                <a style="cursor:pointer;" data-target="#edit-section" (click)="selectedOpi=goal;selectedInitiative=initiate;selectedActivity=activit;selectedMeasure=msr;showOpi(goal,msr)">view</a>
                              </td>
                            </tr>
                          </table>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </tbody>
        <tfoot *ngIf="!goals.length">
          <tr>
            <td colspan="4" class="text-center">No Data to Display .,.</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

  <!-- Modal -->
  <div class="modal fade" id="feedbackModal" role="dialog">
      <div class="modal-dialog">
      
        <!-- Modal content-->
        <div class="modal-content" *ngIf="selectedLevel">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">{{selectedMeasure.opi}}</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="optradio">Feedback :</label>
              <label class="radio-inline">
                <input type="radio" name="optradio" [(ngModel)]="selectedLevel.feedback" value="true">Approve
              </label>
              <label class="radio-inline">
                <input type="radio" name="optradio" [(ngModel)]="selectedLevel.feedback" value="false">Reject
              </label>
            </div>
            <div class="form-group">
              <label for="comment">Comment :</label>
              <textarea class="form-control" id="comment" name="comment" [(ngModel)]="selectedLevel.comment"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-btn-success" (click)="setQuarterFeedback(selectedLevel)">Submit</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
        
      </div>
    </div>